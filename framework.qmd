# Framework
{{< include macros.qmd >}}

Every data-driven engineering problem is unique. But there are also similarities among all engineering problems. We are going to learn a framework that allows us to frame and work out some important aspects of any data-driven engineering problem, and of any sub-problems into which a problem can be broken down. This framework is build on notions and on a set of principles that help us analyse the problem. This set of principles is important because it mathematically guarantees an optimal solution to the problem -- within the goals, means, and data into which we framed the problem.

## Our goal: not "success", but optimality

What can we demand of a method for facing engineering problems?

A typical and important aspect in any engineering problem is that there are several possible decisions, or courses of actions, available. The question is which one to choose. Making a particular decision will lead to some consequences, which could get us close to the desired goal but also lead to something else, possibly undesirable. Making a decision is often difficult because **its consequences are not known with certainty, given the information and data available** in the problem. We may lack information and data about past or present details, about future events and responses, and so on. Yet a decision has to made nevertheless. This is what we call a [**decision problem under uncertainty**]{style="color:#4477AA;"} or [**under risk**]{style="color:#4477AA;"}, or simply a "decision problem" for short.

By definition, in a decision problem under uncertainty there is generally no method to *determine* the decision that will surely lead to the desired consequence (if such a method existed, then the problem would not be one of deciding under uncertainty). Therefore, if there is a method to deal with decision problems, its goal cannot be the determination of the *successful* decision. This also means that a priori we cannot blame an engineer for making an unsuccessful decision in a situation of uncertainty.

Imagine two persons, Henry and Tina, who must bet on "heads" or "tails" under the following conditions (and who otherwise don't get any special thrill from betting):

- if the bet is "heads" and the coin lands "heads", the person wins a *small* amount of money; but if it lands "tails", they lose a *large* amount of money.
- if the bet is "tails" and the coin lands "tails", the person *wins* a small amount of money; if it lands "heads", they lose the same *small* amount of money.

Henry chooses the first bet, on "heads". Tina chooses the second bet, on "tails". The coin comes down "heads". So Henry wins the small amount of money, while Tina loses it small amount. What would we say about their decisions?

Henry's decision was lucky, and yet *irrational*: he risked losing much more money than in the second bet, without any possibility of winning more. Tina's decision was unlucky, and yet *rational*: the possibility and amount of winning was the same in the two bets, and she chose the bet with the least amount of loss. We expect that any person making Henry's decision in similar, future bets will eventually lose more money than any person making Tina's decision.

This example shows two points. First, "success" is generally not a good criterion to judge a decision under uncertainty. Second, even if there is no method to determine which decision is successful, there seems to be a method to determine which decision is rational or [**optimal**]{style="color:#4477AA;"}, given the particular gains, losses, and uncertainties involved in the decision problem.

Such a method indeed does exist, and its explanation and use will be the core of the present notes.

Let us emphasize, however, that we are not giving up on "success", or trading it for "optimality". Indeed we'll find that **the method automatically leads to the *successful* decision** in problems where uncertainty is not present or is irrelevant. It's a win-win. It's important to keep this point in mind:

::::: {.column-page-inset-right}
:::: {.callout-note appearance="default" icon=false}
##
[Aiming to find the solutions that are *successful* can make us *fail* to find those that are optimal when the successful ones cannot be determined.]{style="color:#AA3377;font-size:125%"}

[Aiming to find the solutions that are *optimal* makes us automatically find those that are *successful* when those can be determined.]{style="color:#4477AA;font-size:125%"}
::::
:::::

We shall later witness this fact with our own eyes, and will take it up again in the discussion of some misleading techniques to evaluate machine-learning algorithms.

\

There are other important aspects in engineering problems, besides the one of making decisions under uncertainty. For instance the *discovery* or the *invention* of new technologies and solutions. These aspects can barely be planned or decided; but their fruits, once available, should be handled and used optimally -- thus leading to a decision problem.

Artificial intelligence is proving to be a valuable aid in these more creative aspects too. This kind of use of AI is outside the scope of the present notes. Some aspects of this creativity-assisting use, however, do fall within the domain of the present notes. A pattern-searching algorithm, for example, can be optimized by means of the method we are going to study.


## Decision Theory

We want a method that allows an engineer to make optimal decisions in uncertain situations, and successful decisions in situations with no uncertainty. What other kinds of features should such a method have, in order to be applied to as many kinds of decision problems as possible?

If we find an optimal course of action in regards to some outcome, it may still happen that the course of action can in practice be realized in several ways that are equivalent in regard to the outcome, but inequivalent in regard to time or resources. We thus face a decision within a decision. In general, a decision problem may involve several decision sub-problems, in turn involving decision sub-sub-problems, and so on.

The main engineering goal itself could be to design and build an automated or AI-based device capable of making an optimal decision in a specific kind of uncertain situations. Think for instance of an aeronautic engineer designing an autopilot system.

Therefore, to analyse and tackle this kind of problems we would like to have a framework with the following features:

- it should tell us what's optimal and, when possible, what's successful

- it should take into consideration choices, consequences, costs and gains

- it should be able to deal with uncertainties

- it should be susceptible to recursive or modular application, if needed

- it should be suited to being used not only for human decision-makers, but also for automated or AI devices.

A framework with these features exists: it is [**Decision Theory**]{style="color:#4477AA;"}.

Decision Theory has a long history, going back to Leibniz in the 1600s and partly even to Aristotle in the &minus;300s, and appearing in its present form around 1920--1960. What's remarkable about it is that it is not only *a* framework, but *the* framework we must use. A logico-mathematical theorem shows that any framework that does not break basic optimality and rationality criteria has to be equivalent to Decision Theory (in other words, it can use different technical terminology and rewrite mathematical operations in a different way, but it boils down to the same notions and operations of Decision Theory). So if you wanted to invent and use another framework, then either (a) it would lead to some irrational or illogical consequences, or (b) it would lead to results identical to Decision Theory's. Many frameworks that you are probably familiar with, such as optimization theory, are just specific applications or particular cases of Decision Theory.

Decision Theory can be roughly divided into two main parts: [**Probability Theory**]{style="color:#4477AA;"}, which deals with information, data, uncertainty, inference; and [**Utility Theory**]{style="color:#4477AA;"}, which deals with actions, consequences, gain and loss, decisions. We shall get acquainted with Decision Theory step by step, introducing its main ideas and notions as they become necessary.


## Anatomy of a decision problem

An extremely important -- and surprisingly often neglected -- first step in every engineering problem is to define exactly what the problem is. This means, in particular, to specify unambiguously the goals, the available data and information, the available decisions or courses of action, the hypotheses of interest.

Decision theory analyses any problem in terms of nested or sequential basic decision problems, each of which is framed in terms of these elements:

::::{.column-margin}
:::{.callout-tip}
## {{< fa seedling >}}
Remember: What matters is to be able to identify these elements in a concrete engineering problem, understanding their role. Their technical names don't matter.
:::
::::

- [**Agent**]{style="color:#4477AA;"}, and [**background**]{style="color:#4477AA;"} or  [**prior information**]{style="color:#4477AA;"}: the agent is the person or device that has to make an optimal decision. An agent has some specific background information and data that are used and taken for granted in the decision-making process. Since different agents typically have different background information, we shall somehow conflate them.

- [**Decisions**]{style="color:#4477AA;"} or [**courses of actions**]{style="color:#4477AA;"}: the choices available to the agent.

- [**Assumptions**]{style="color:#4477AA;"}: data and information that are known, or temporarily imagined to be known, to the agent. Assumptions are different from background information because the latter is never used for hypothetical or counterfactual reasoning -- a difference that will become clear shortly.

- [**Outcomes**]{style="color:#4477AA;"}: hypotheses, conjectures, or actual facts that the agent wishes to assess; often they depend on the possible decisions.

- [**Probabilities**]{style="color:#4477AA;"}: forecasting the outcomes given the assumptions, and the uncertainty of these forecasts.

- [**Utilities**]{style="color:#4477AA;"}: the gains and losses involved in making each possible decision.

Together with the "assumptions" and "outcomes" it is also useful to keep in mind two more, somewhat different elements:

- [**Knowns**]{style="color:#4477AA;"}: the data and information that are actually known to the agent.

- [**Unknowns**]{style="color:#4477AA;"}: hypotheses, conjectures, and situations whose truth or falsity are actually unknown to the agent.

The basic idea is that the agent will [**infer**]{style="color:#4477AA;"} the outcomes given the assumptions, with some degree of [**uncertainty**]{style="color:#4477AA;"}. From these inferences it will determine the [**optimal**]{style="color:#4477AA;"} decision.

A basic decision problem and some of its elements can be graphically represented in a diagram like this:

::::: {.column-page-inset-right}
![](decision_tree.svg){width=100%}
:::

It has one *decision node*, usually represented by a square {{< fa regular square >}}, from which the available decisions depart as lines. Each decision leads to an *uncertainty node*, usually represented by a circle {{< fa regular circle >}}, from which the possible outcomes depart as lines. Each outcome leads to a particular utility value. The uncertainty of each outcome is quantified by a probability, which depends on the assumptions common to the problem and, often, on the decision.

{{< fa exclamation-circle >}}\ \ A priori there isn't any particular temporal order among decisions, outcomes, and even assumptions. In some cases an outcome happens after a decision; for instance, you pick an umbrella, and then it rains. In other cases the outcome already happened before the decision; for instance, a clinician decides to treat a patient who might have a disease, but the disease, if present, was already there before the clinician's decision. The difference between decisions and outcomes is not one of time, but of control: decisions are under our control; outcomes are not and are generally uncertain.

:::{.callout-note}
## Example
> A particular kind of electronic component is produced on an assembly line. At the end of the line, an automated inspection device makes some tests on every newly produced component. The tests give an uncertain forecast of whether the component would fail within less than a year of use, or after a year.
>
> Depending on the test results, the automated inspector approves the component, or discards it. An approved component is sold, leading to some net monetary gain if it works for at least a year; but leading to a net loss if it fails within a year, owing to damage and warranty refunds. A discarded component doesn't lead to any gain or loss.
\

A decision problem is involved in this process: one for every new component that arrives at the automated inspector. The elements of the problem can be identified as follows:

- *Agent* and *background information*: the automated inspector (and indirectly the engineer who designed and programmed it), and its builtin knowledge base.
- *Decisions*: approve the new electronic component, or discard it.
- *Assumptions*: the values obtained from the tests.
- *Outcomes*: three possible ones: (1) failure of the component within a year, (2) survival of the component for longer than a year, (3) destruction of the component. Either of the first two outcomes can happen if the component is sold; the third outcome happens if the component is discarded.
- *Probabilities*: the quantified forecast of failure within a year if the component were sold. If the component is discarded, there's nothing to forecast.
- *Utilities*: The gains or losses to be had if the component is sold and doesn't fail within a year, if it's sold and fails, and if it's discarded.
:::
:::{.callout-caution}
## Exercise
Suppose that a new component arrives at the inspector. Tests give a `10%` probability of failure within a year, and `90%` otherwise, if the component is approved. If the component is approved, it will be sold for a net gain of `1$` if it works for a year, but for a net *loss* of `5$` if it fails instead. If the component is discarded, there won't be any net gain or loss.

1. Sketch the diagram for this basic decision problem.

2. Should the automated inspector `approve` or `discard` this new component? Try to make a decision on intuitive grounds, trying to interpret what the probabilities and utilities given above could mean. What kind of background information did you use?
:::

Some of the decision-problem elements listed above may themselves need to be analysed by a decision sub-problem. For instance, the utilities could depend on uncertain factors: thus we have a decision sub-problem to determine the optimal values to be used for the utilities of the main problem. This is an example of the modular character of decision theory.

The elements above must be identified unambiguously in every decision problem. The analysis into these elements greatly helps in making the problem and its solution well-defined. Suppose someone (probably a politician) says: "We must solve the energy crisis by reducing energy consumption or producing more energy". This person has effectively said *nothing whatsoever*. By definition the "energy crisis" is the problem that energy production doesn't meet demand. So this person has only said "we would like the problem to be solved", without specifying any solution. A decision-theory approach to this problem requires us to specify which concrete courses of action should be taken for reducing consumption or increasing productions, and what their costs, gains, and probable outcomes would be.

::::{.column-margin}
::: {.callout-tip}
## {{< fa book-open >}} For the curious
See MacKay's options-vs-costs rational analysis in [Sustainable Energy -- without the hot air](https://www.withouthotair.com)
:::
::::

An advantage of decision theory is that its application *forces* us to make sense of an engineering problem. A useful procedure is to formulate the general problem in terms of the elements above, identifying them clearly. If the definition of any of the terms involves uncertainty of further decisions, then we analyse it in turn as a decision sub-problem, and so on.

