# [Conditional probability distributions]{.green}
{{< include macros.qmd >}}
{{< include macros_marg_cond.qmd >}}

## Conditional probability: augmenting knowledge {#sec-conditional-probs}

When we introduced the notion of degree of belief -- a.k.a. probability -- in [chapter @sec-probability], we stressed the fact that *every probability is conditional on some state of knowledge or information*. So the term "conditional probability" sounds like a [pleonasm](https://dictionary.cambridge.org/dictionary/english/pleonasm), just like saying "round circle".

This term must be understood in a way analogous to "marginal probability": it applies in situations where we have two or more sentences of interest. We speak of a "conditional probability" when we want to emphasize that additional sentences  appear in the conditional (right side of "$\|$") of that probability, as compared to other probabilities. For instance, in a scenario in which these two probabilities appear:

$$
\P(\se{A} \| \se{B} \and \yI)
\qquad
\P(\se{A} \| \yI)
$$

we call the first [**conditional probability**]{.blue} of $\se{A}$ ([**given**]{.blue} $\se{B}$) to emphasize or point out that its conditional includes an additional sentence ($\se{B}$), whereas the conditional of the second probability doesn't.

Such emphasis is important because it also means that the "conditional" probability is based on some *additional knowledge, information, or hypothesis* with respect to the "non-conditional" one. This has obvious connections with the idea of "learning". Indeed the calculation of "conditional" probabilities enters in all situations (even if hypothetical or counterfactual, see [§ @sec-inference-scenarios]) in which some knowledge is augmented by new knowledge. This can happens in several ways, which we now examine.


## Conditional from joint probability: dissimilar quantities {#sec-conditional-joint-dis}

Consider once more the next-patient arrival scenario of [§ @sec-repr-joint-prob], with joint quantity $(U,T)$ and an agent's joint probability distribution as in [table @tbl-urgent-arrival]. Suppose that the agent must forecast whether the next patient will require $\urge$ or $\nonu$ care, so it needs to calculate the probability distribution for $U$ (that is, the probabilities for $U\mo\urge$ and $U\mo\nonu$). 

In the first exercise of [§ @sec-marginal-probs] you found that the marginal probability that the next patient will need urgent care is

$$\P(U\mo\urge \| \yi[H]) = 18\%$$

this is the agent's degree of belief if it has the knowledge encoded in the sentence $\yi[H]$, nothing more and nothing less.

But now let's imagine that the agent *receives a new piece of information*: it is told that the next patient is being transported by helicopter. In other words, the agent now knows that the sentence $T\mo\heli$ is true. The agent's complete knowledge is then encoded in the `and`ed sentence

$$T\mo\heli \land \yi[H]$$

which should therefore appear in the conditional. The agent's belief that the next patient requires urgent care is therefore

$$\P(U\mo\urge \| T\mo\heli \and \yi[H])$$

Calculation of this probability can be done by just one application of the `and`-rule:

:::{.column-page-inset-right}
$$
\begin{aligned}
&\P(U\mo\urge \and T\mo\heli \| \yi[H]) =
\P(U\mo\urge \| T\mo\heli \and \yi[H]) \cdot
\P(T\mo\heli \| \yi[H])
\\[3ex]
&\quad\implies\quad
\P(U\mo\urge \| T\mo\heli \and \yi[H])
=
\frac{
\P(U\mo\urge \and T\mo\heli \| \yi[H])
}{
\P(T\mo\heli \| \yi[H])
}
\end{aligned}
$$
:::

We do have the joint probability for $U\mo\urge \land T\mo\heli$ that appears in the numerator of the fraction above. The probability in the denominator is just a marginal probability for $T$, and we know how to calculate that too from [§ @sec-marginal-probs]. Finally we find

$$
\P(U\mo\urge \| T\mo\heli \and \yi[H])
=\frac{
\P(U\mo\urge \and T\mo\heli \| \yi[H])
}{
\sum_u\P(U\mo u \and T\mo\heli \| \yi[H])
}
$$

where it's understood that the sum index $u$ runs over the values $\set{\urge, \nonu}$.

This is called a [**conditional probability**]{.blue}; in this case, the conditional probability of\ \ $U\mo\urge$\ \ [**given**]{.blue}\ \ $T\mo\heli$.

The collection of probabilities for all possible values of the quantity $U$, given a *specific* value of the quantity $T$, say $\heli$:

$$
\P(U\mo\urge \| T\mo\heli \and \yi[H]) \ ,
\qquad
\P(U\mo\nonu \| T\mo\heli \and \yi[H])
$$

is called the [**conditional probability distribution**]{.blue} for $U$\ \ [**given**]{.blue}\ \ $T\mo\heli$. It is indeed a probability distribution because the two probabilities sum up to $1$.

:::{.callout-warning}
## {{< fa exclamation-circle >}}
Note that the collection of probabilities for, say, $U\mo\urge$, but for *different* values of the conditional quantity $T$, that is

$$
\P(U\mo\urge \| T\mo\ambu \and \yi[H]) \ ,
\qquad
\P(U\mo\urge \| T\mo\heli \and \yi[H]) \ ,
\qquad
\P(U\mo\urge \| T\mo\othe \and \yi[H])
$$

is **not** a probability distribution. Calculate the three probabilities above and check that indeed they do not sum up to one.
:::

:::{.callout-caution}
## {{< fa user-edit >}} Exercise
- Using the values from [table @tbl-urgent-arrival] and the formula for marginal probabilities, calculate:

    + The conditional probability that the next patient needs urgent care, given that the patient is being transported by helicopter.
    
    + The conditional probability that the next patient is being transported by helicopter, given that the patient needs urgent care.

- Now discuss and find an intuitive explanation for these comparisons:

    + The two probabilities you obtained above. Are they equal? why or why not?
	
	+ The *marginal* probability that the next patient will be transported by helicopter, with the *conditional* probability that the patient will be transported by helicopter *given* that it's urgent. Are they equal? if not, which is higher, and why?
:::

\

## Conditional from joint probability: similar quantities {#sec-conditional-joint-sim}

In the previous section we examined how knowledge about one quantity of a particular kind can change an agent's degree of belief about a quantity of a different kind, for example "transportation" about "urgency" or vice versa. This change is reflected in the value of the corresponding conditional probability.

This kind of change can also occur with quantities of a "similar kind", that is, quantities that represent the same kind of phenomenon and have exactly the same domain. The maths and calculations are identical to those we have explored, but the interpretation and application can be somewhat different.

As an example, imagine a scenario similar to the next-patient one above, but now consider the *next three patients* to arrive, and their urgency. Define the following three quantities:

$U_1$ : urgency of the next patient\
$U_2$ : urgency of the second future patient from now\
$U_3$ : urgency of the third future patient from now\

every one of these quantities has the same domain: $\set{\urge,\nonu}$.

The joint quantity $(U_1, U_2, U_3, U_4)$ has a domain with 23 = 8 possible values:

- $U_1\mo\urge \and U_2\mo\urge \and U_3\mo\urge$
- $U_1\mo\urge \and U_2\mo\urge \and U_3\mo\nonu$
- . . .
- $U_1\mo\nonu \and U_2\mo\nonu \and U_3\mo\urge$
- $U_1\mo\nonu \and U_2\mo\nonu \and U_3\mo\nonu$

Suppose that an agent, with background information $\yI$, has a joint probability distribution for the joint quantity $(U_1, U_2, U_3)$; the distribution is implicitly given as follows:
<!-- 0 53.6  -->
<!-- 1 11.4  -->
<!-- 2 3.6  -->
<!-- 3 1.4  -->

- If $\urge$ appears 0 times out of 3: probability = $53.6\%$
- If $\urge$ appears 1 times out of 3: probability = $11.4\%$
- If $\urge$ appears 2 times out of 3: probability = $3.6\%$
- If $\urge$ appears 3 times out of 3: probability = $1.4\%$

examples:

$$
\begin{aligned}
&\P(U_1\mo\urge \and U_2\mo\nonu \and U_3\mo\urge \| \yI)
= 0.036
\\[1ex]
&\P(U_1\mo\nonu \and U_2\mo\urge \and U_3\mo\nonu \| \yI)
= 0.114
\\[1ex]
&\P(U_1\mo\urge \and U_2\mo\urge \and U_3\mo\nonu \| \yI)
= 0.036
\\[1ex]
\end{aligned}
$$

:::{.callout-caution}
## {{< fa user-edit >}} Exercise
- Check that the joint probability distribution as defined above indeed sums up to $1$.

- Calculate the marginal probability for $U_1\mo\urge$, that is,\ \ $\P(U_1\mo\urge \|\yI)$.
<!-- 0.2 -->

- Calculate the marginal probability that the second and third patients are non-urgent cases, that is

$$\P(U_2\mo\nonu \and U_3\mo\nonu \|\yI) \ .$$
<!-- 0.65 -->
:::

From this joint probability distribution the agent can calculate, among other things, its degree of belief that the *third* patient from now will require urgent care, regardless of the urgency of the preceding two patients. It's the marginal probability

:::{.column-page-inset-right}
$$
\begin{aligned}
\P(U_3\mo\urge \| \yI)  &= 
\sum_{u_1}\sum_{u_2}
\P(U_1\mo u_1 \and U_2\mo u_2 \and U_3\mo \urge \| \yI)
\\[1ex]
&= 0.114 + 0.036 + 0.036 + 0.014
\\[1ex]
&= \boldsymbol{20.0\%}
\end{aligned}
$$
:::

where the first term $0.114$ in the sum corresponds to $U_1\mo\nonu\and U_2\mo\nonu\and U_3\mo\urge$, the second term $0.036$ to $U_1\mo\nonu\and U_2\mo\urge\and U_3\mo\urge$, and so on.

Therefore the agent, right now, has a $20\%$ degree of belief that the third patient from now will require urgent care.

\

Now fast-forward in time, after *two* patients have arrived and been taken good care of. Suppose that *both were non-urgent cases*, and the agent knows this. The agent needs to forecast whether the next (third) patient will require urgent care.

It wouldn't be sensible to use\ \ $\P(U_3\mo\urge \|\yI)$,\ \ calculated above, because this degree of belief represents an agent having only the background knowledge $\yI$. Now, instead, the agent has additional information about the first two patients, encoded in this `and`ed sentence:

$$
U_1\mo\nonu \and U_2\mo\nonu
$$

The relevant degree of belief is therefore the *conditional* probability

$$
\begin{aligned}
&\P(U_3\mo\urge \| U_1\mo\nonu \and U_2\mo\nonu \and \yI)
\\[2ex]
&\qquad{}=
\frac{
\P(U_1\mo\nonu \and U_2\mo\nonu \and U_3\mo\urge \| \yI)
}{
\P(U_1\mo\nonu \and U_2\mo\nonu \| \yI)
}
\\[1ex]
&\qquad{}=\frac{0.114}{0.65}
\\[2ex]
&\qquad{}\approx
\boldsymbol{17.5\%}
\end{aligned}
$$

This conditional probability of $17.5\%$ for $U_3\mo\nonu$ is *lower* than the marginal one $20.0\%$ calculated previously. **Observation of two patients has thus affected the agent's degree of belief**.

\

Let's also check how the agent's belief changes in the case where the first two patients are both urgent. The calculation is completely analogous:

$$
\begin{aligned}
&\P(U_3\mo\urge \| U_1\mo\urge \and U_2\mo\urge \and \yI)
\\[2ex]
&\qquad{}=
\frac{
\P(U_1\mo\urge \and U_2\mo\urge \and U_3\mo\urge \| \yI)
}{
\P(U_1\mo\urge \and U_2\mo\urge \| \yI)
}
\\[1ex]
&\qquad{}=\frac{0.030}{0.107}
\\[2ex]
&\qquad{}\approx
\boldsymbol{28.0\%}
\end{aligned}
$$

In this case the conditional probability $28.0\%$ for $U_3\mo\urge$ is *higher* than the marginal one $20.0\%$.

One possible intuitive explanation of these probability changes, *in the present scenario*, is that observation of two non-urgent cases makes the agent slightly more confident that "this is a day with few urgent cases"; whereas observation of two urgent cases makes the agent more confident that "this is a day with many urgent cases".



:::{.callout-warning}
## {{< fa exclamation-circle >}}
In general we cannot say that the probability of a particular value (such as $\urge$ in the scenario above) will decrease or increase as similar or dissimilar values are observed, nor how much the increase or decrease will be.

In a different situation the probability of $\urge$ could actually **increase** as more and more $\nonu$ cases are observed. Imagine, for instance, a scenario where the agent initially knows that there are 10 urgent and 90 non-urgent cases ahead. Having observed 90 non-urgent cases, the agent will give a much higher probability -- 100% -- that the next case will be an urgent one.

The differences among such scenarios are reflected in differences of the joint probabilities, from which the conditional probabilities are calculated.

**All** these situations are correctly handled with the four fundamental rules of inference and the formula for conditional probability derived from them.
:::


:::{.callout-caution}
## {{< fa user-edit >}} Exercises

a. Using the same joint distribution above, calculate

    $$\P(U_1\mo\urge \| U_2\mo\nonu \and U_3\mo\nonu \and \yI)$$
	
	that is, the probability that the next patient will require urgent care *given that the agent knows the second and third patients will not-require urgent care*.
	
	- Why is the value obtained different from\ \ $\P(U_1\mo\urge \|\yI)$ ?
	
	- Describe a scenario in which the calculation above makes sense (and patients 2 and 3 still arrive after patient 1).

\

b. Do an analysis completely analogous to the previous, three-patient one, but with different background information $\yJ$ that gives a joint probability distribution for $(U_1, U_2, U_3)$ as follows:

    • If $\urge$ appears 0 times out of 3: probability = $0\%$\
    • If $\urge$ appears 1 times out of 3: probability = $24.5\%$\
    • If $\urge$ appears 2 times out of 3: probability = $7.7\%$\
    • If $\urge$ appears 3 times out of 3: probability = $3.0\%$

    1. Calculate

        $$\P(U_3\mo\urge \|\yJ)$$

        and

        $$\P(U_3\mo\urge \| U_1\mo\nonu \and U_2\mo\nonu \and \yJ)$$

        and compare them.

    2. Explain why this particular change in degree of belief occurs, in this situation.

<!--      i1 i2 i3        p   num   den -->
<!-- [1,]  0  0  1 1.000000 0.245 0.245 -->
<!-- [2,]  0  1  1 0.239130 0.077 0.322 -->
<!-- [3,]  1  0  1 0.239130 0.077 0.322 -->
<!-- [4,]  1  1  1 0.280374 0.030 0.107 -->
:::

\

::: {.callout-caution}
## {{< fa book >}} Study reading
- § 5.4 of [*Risk Assessment and Decision Analysis with Bayesian Networks*](https://hvl.instructure.com/courses/25074/modules/items/664427)

- §§ 12.2.1 and 12.3 of [*Artificial Intelligence*](https://hvl.instructure.com/courses/25074/modules/items/660089)

- §§ 5.1--5.5 of [*Probability*](https://hvl.instructure.com/courses/25074/modules/items/675505) -- yes, once more!
:::

## General case and remarks on the previous two sections {#sec-remarks-conditional-similar}

Take the time to review the two sections above, focusing on the application and meaning of the two scenarios and calculations, and noting the similarities and differences:

- [{{< fa equals >}} The calculations were completely analogous; in particular, the conditional probability was obtained as the quotient of a joint probability and a marginal one.]{.green}

- [{{< fa not-equal >}} In the first (next-patient) scenario, information about one aspect of the situation changed the agent's belief about another aspect; the two aspects were somewhat different (transportation and urgency). Whereas in the second (three-patient) scenario, information about analogous occurrences of an aspect of the situation changed the agent's belief about a further occurrence.]{.yellow}

Both kinds of inference scenarios -- considering one aspect to infer another, and considering some occurrences to infer new ones -- frequently occur in data science and engineering. In machine learning, the first scenario is connected to "supervised learning", the second to "unsupervised learning". As you just saw, the probability calculus "sees" them as analogous: information about something changes and agent's beliefs about something else. And the handling of both cases is perfectly covered by the four fundamental rules of inference.

\

Let's now consider a more generic case of a joint quantity with component quantities $\green X$ and $\red Y$, whose joint probability distribution is given. The conditional probability for $\red Y$, given that $\green X$ has some specific value $\green x^*$, is then

$$
\P({\red Y\mo y}\| {\green X\mo x^*}\and\yI) =
\frac{
\P({\red Y\mo y} \and {\green X\mo x^*}\|\yI)
}{
\sum_{\red \upsilon}\P({\red Y\mo \upsilon}\and {\green X\mo x^*}\|\yI)
}
$$

for all possible values $\red y$.

\

## Conditional from conditional probability {#sec-conditional-conditional}

As emphasized in [§ @sec-inference-origin], probabilities are either obtained from other probabilities, or taken as given probabilities, maybe determined by symmetry requirements. This is also true when we want to calculate conditional probabilities.

Up to now we have calculated conditional probabilities starting from the joint distribution as given.





<!-- Considering now a more generic case of a joint probability with component quantities $\green X$ and $\red Y$, the probability for a specific value of $\red Y$, conditional on knowledge that $\green X\mo x$ and  some information $\yI$, is given by -->

<!-- $$ -->
<!-- \P({\red Y\mo y}\| {\green X\mo x} \and \yI) = \frac{ -->
<!-- \P({\red Y\mo y} \and {\green X\mo x} \| \yI) -->
<!-- }{ -->
<!-- \sum_{\red \upsilon} \P({\red Y\mo \upsilon} \and {\green X\mo x} \| \yI) -->
<!-- } -->
<!-- $$ -->

<!-- <\!-- :::{.callout-warning} -\-> -->
<!-- <\!-- ## -\-> -->
<!-- <\!-- {{< fa exclamation-circle >}} Always keep in mind that these are just convenient shorthands for -\-> -->
<!-- <\!-- $$ -\-> -->
<!-- <\!-- \P(\pr{The quantity \(X\) has value \(x\)} \land  -\-> -->
<!-- <\!-- \pr{The quantity \(Y\) has value \(y\)} -\-> -->
<!-- <\!-- \| \yI) -\-> -->
<!-- <\!-- $$ -\-> -->
<!-- <\!-- ::: -\-> -->

<!-- Now consider these two situations: -->

<!-- 1. the agent acquires knowledge that $X$ has true value $x$, so its state of knowledge has changed; -->

<!-- 2. for inference purposes, the agents needs to *hypothetically* assume that the quantity $X$ has value $x$ (even if that might not be the case in reality); -->

<!-- and, in either situation, the agent needs the probability that $Y$ has value $y$. This probability is written, in either situation as -->

<!-- $$ -->
<!-- \P({\red Y\mo y} \| {\green X\mo x} \and \yI) -->
<!-- $$ -->

